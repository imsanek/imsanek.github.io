<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="description" content="Бутик отель История в Алуште">
        <meta name="keywords" content="Бутик отель История в Алуште">
        <meta name="format-detection" content="telephone=no">
        <meta http-equiv="Cache-Control" content="no-cache">
		<link rel="canonical" href="https://hotel-istoria.ru/sub/search.html"/>
        <title>Бутик отель История в Алуште</title>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
        <link href="../css/search.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    </head>
    <body>
        <img src="../img/map2.jpg" alt="background" class="body_bg">
        <header class="header">
            <div class="header-wrapper">
                <div class="header-logo">

                </div>
                <div class="header-nav">
                    <a href="../index.html"><span>Главная</span></a>
                </div>
                <div class="header-nav">
                    <a href="about.html"><span>Об отеле</span></a>
                </div>
                 
                <div class="header-nav">
                    <a href="offer.html"><span>Акции</span></a>
                </div>
                <div class="header-nav">
                    <a href="contacts.html"><span>Контакты</span></a>
                </div>
                <div class="header-nav">
                    <span>г. Алушта, пер. Ревкомовский 3-A</span>
                    <span>+7-978-949-33-55</span>
                </div>
                <div class="social">
                    <div class="social-img1"></div>
                    <div class="social-img2"></div>
                </div>
            </div>
        </header>
        
        <div class="wrapper" style="margin-top: 120px;padding: 10px;">
            <div class="offer-box">
                    <span class="offer-box-span"></span>
            </div>
        </div>

        <div class="booking">
            
        </div>

        <div class="content-text">БУТИК-ОТЕЛЬ «ИСТОРИЯ» НА КАРТЕ</div>
        <div class="map">
            <iframe src="https://yandex.ru/map-widget/v1/?um=constructor%3A261db761f322545b01b6d801371ffff3d5c34bb09abc1d5a81a66ca7085c0f75&amp;source=constructor" width="1100px" height="450" frameborder="0"></iframe>
        </div>


        <div class="footer2">
            <div class="weather">
                <div id="inf_hmn_pl" hidden></div>
                <div class="area"></div>
                <div class="weather-case">
                    <div class="day">Температура днём: </div>
                    <div class="night">Температура ночью: </div>
                    <div class="water">Температура воды: </div>
                </div>
            </div>
        </div>
        <div class="footer" id="contacts">
            <div class="footer-text__left">
                <ul>
                    <li>298500, Россия,</li>
                    <li>Республика Крым, Алушта,</li>
                    <li>пер. Ревкомовский 3-а</li>
                    <li>тел.: +7-978-949-33-55</li>
                    <li>e-mail: istoria-info@mail.ru</li>
                </ul>
            </div>
            <div class="footer-text__center">
                <a href="../img/credit.pdf" target="_blank">
                    <img src="../img/credit.png" alt="Свидетельство">
                </a>
            </div>
            <div class="footer-text__right">
                <ul>
                    <li>Уважаемые гости бутик-отеля «История»!</li>
                    <li>Для улучшения работы отеля прошу Вас</li>
                    <li>направлять свои предложения</li>
                    <li>на мою личную почту istoria-info@mail.ru</li>
                    <li>С уважением, Новикова  Любовь Владимировна.</li>
                </ul>
            </div>
            
        </div>
        
        <script>

            var priceJSON;
            $.ajax({
                url: '../api/price.json',  
                method: 'get',             
                dataType: 'html',          
                success: function(data){   
                    priceJSON = JSON.parse(data);
                    console.log(priceJSON);
                },
                error: function(jqXHR) {
                    console.log(jqXHR.status);
                    $('.info').append($('<section/>', {
                        'class': 'ERROR hidden',
                        text: 'ERROR: ' + jqXHR.status
                    }))
                    $('.ERROR').hide();
                    $('.ERROR').fadeIn(1200);
                }
            });

            function getDays(){
                var days = [];
                var date1 = new Date(getUrlParameter('date1'));
                var date2 = new Date(getUrlParameter('date2'));
                while (date1 <= date2) {
                    var mounth;
                    mounth = date1.getDate();
                    var dateStr = mounth+"-"+(date1.getMonth()+1).toString()+"-"+date1.getFullYear().toString();
                    days.push(dateStr);
                    date1.setDate( date1.getDate() + 1 )
                }
                return days;
            }

            function getDaysCount(booking){
                var days = 0;
                var date1 = new Date(getUrlParameter('date1'));
                var date2 = new Date(getUrlParameter('date2'));
                while (date1 <= date2) {
                    days++;
                    date1.setDate( date1.getDate() + 1 )
                }
                return days;
            }

            function height(){
                $('.header-video ').height($('.header-video video').height());
            }

            function getUrlParameter(sParam) {
                var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                    sURLVariables = sPageURL.split('&'),
                    sParameterName,
                    i;

                for (i = 0; i < sURLVariables.length; i++) {
                    sParameterName = sURLVariables[i].split('=');

                    if (sParameterName[0] === sParam) {
                        return sParameterName[1] === undefined ? true : sParameterName[1];
                    }
                }
            };

            function disableScroll() {

            // Получить текущую позицию прокрутки страницы
            scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,
                // при попытке прокрутки установить это значение на предыдущее
                window.onscroll = function() {
                    window.scrollTo(scrollLeft, scrollTop);
                };
            }

            function foundPrice(id, priceJSON){

                var price = 0;
                var days = getDays();

                for(var i = 0; i < days.length - 1; i++){
                    var current = days[i].split("-");
                    var globalMounth = current[1];
                    var globalYear = current[2];
                    var globalDay = current[0];
                
                    if(globalMounth == 1 && globalDay < 11){
                        price += parseInt(priceJSON[id].priceData[0][2]);
                    }else if((globalMounth == 1 && globalDay > 10)|| globalMounth == 2|| globalMounth == 3 || (globalMounth == 4 && globalDay < 29)){
                        price += parseInt(priceJSON[id].priceData[1][2]);
                    }else if((globalMounth == 4 && globalDay > 28) || (globalMounth == 5 && globalDay < 11)){
                        price += parseInt(priceJSON[id].priceData[2][2]);
                    }else if(globalMounth == 5 && globalDay > 10){
                        price += parseInt(priceJSON[id].priceData[3][2]);
                    }else if(globalMounth == 6){
                        price += parseInt(priceJSON[id].priceData[4][2]);
                    }else if(globalMounth == 7 || globalMounth == 8){
                        price += parseInt(priceJSON[id].priceData[5][2]);
                    }else if(globalMounth == 9){
                        price += parseInt(priceJSON[id].priceData[6][2]);
                    }else if(globalMounth >= 10 ){
                        price += parseInt(priceJSON[id].priceData[7][2]);
                    }
                }
                return price;
            }

            function enableScroll() {
                window.onscroll = function() {};
            }

            function validateEmail(email) {
                const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(email.toLowerCase());
            }

            function validatePhone(phone) {
                const re = /^(\+{0,})(\d{0,})([(]{1}\d{1,3}[)]{0,}){0,}(\s?\d+|\+\d{2,3}\s{1}\d+|\d+){1}[\s|-]?\d+([\s|-]?\d+){1,2}(\s){0,}$/gm;
                return re.test(phone);
            }
            var itter = 0;
            function createFullBlock(apiJSON,id){
                console.log("id= ", apiJSON[id].id)
                $('.wrapper').append($('<div/>', {
                    'class': 'content'
                }));

                $('.content:eq('+itter+')').append($('<div/>', {
                    'class': 'number',
                    'id': apiJSON[id].id
                }));
                $('.number:eq('+itter+')').append($('<img/>', {
                    'class': 'number-img',
                    'src': apiJSON[id].img 
                }));
                $('.number:eq('+itter+')').append($('<div/>', {
                    'class': 'number-about' 
                })).append($('<div/>', {
                    'class': 'number-price' 
                }));
                $('.number-about:eq('+itter+')').append($('<span/>', {
                    'text': apiJSON[id].title 
                }));
                $('.number-about:eq('+itter+')').append($('<span/>', {
                    'text': apiJSON[id].about 
                }));
                $('.number-price:eq('+itter+')').append($('<span/>', {
                    'text': 'Цена за ' + (daysCounter-1) + ' ночей' 
                }));

                var price = foundPrice(id, priceJSON);
                

                if(children == "с ребёнком"){
                    $('.number-price:eq('+itter+')').append($('<span/>', {
                        'text': (price + (price * 0.3)) + ' руб.' 
                    }));
                }else{
                    $('.number-price:eq('+itter+')').append($('<span/>', {
                        'text':  price + ' руб.' 
                    }));
                }
                $('.number-price:eq('+itter+')').append($('<button/>', {
                    'class': 'booking-button',
                    'text': 'Забронировать!' 
                }));
                var currentTarget
                $('.booking-button:eq('+itter+')').click(function(){
                    disableScroll();
                    currentTarget = $(this).parent().parent().attr('id');
                    $('body').append($('<div/>', {
                        'class': 'pop-up'
                    })).append($('<div/>', {
                        'class': 'full-content'
                    }));
                    

                    $('.pop-up').fadeIn(300).click(function(){
                        $(this).remove();
                        $('.full-content').remove();
                        enableScroll();
                    });

                    $('.full-content').hide().fadeIn(400).append($('<span/>', {
                        'class': 'full-text',
                        'text': 'Этап бронирования'
                    })).append($('<span/>', {
                        'class': 'min-text',
                        'text': 'Оставьте Ваши данные и мы свяжемся с Вами!'
                    })).append($('<input/>', {
                        'type': 'text',
                        'class': 'booking-input',
                        'id': 'book-name',
                        'placeholder': 'Ваше имя'
                    })).append($('<input/>', {
                        'type': 'text',
                        'class': 'booking-input',
                        'id': 'book-phone',
                        'placeholder': 'Контактный телефон'
                    })).append($('<input/>', {
                        'type': 'text',
                        'class': 'booking-input',
                        'id': 'book-mail',
                        'placeholder': 'Электронная почта'
                    })).append($('<button/>', {
                        'class': 'final-booking',
                        'text': 'Отправить заявку!' 
                    }));

                    $('.final-booking').click(function(){
                        $('.error-frame').removeClass('error-frame');
                        var errors = 0;
                        if(!validatePhone($('#book-phone').val())){
                            $('#book-phone').addClass('error-frame');
                            errors++;
                        }
                        if(!validateEmail($('#book-mail').val())){
                            $('#book-mail').addClass('error-frame');
                            errors++;
                        }
                        if(errors == 0){
                            console.log('iter=  = ', currentTarget);

                            var query = currentTarget;
                            console.log(query);
                            var url = '../api/add-ticket.php';
                            var phone = $("#book-phone").val();
                            var name = $("#book-name").val();
                            var email = $("#book-mail").val();
                            var date = booking;
                            var apiJSON;
                            console.log("currentTarget - " + (currentTarget-1) + " price - " + $('.number-price:eq('+ (currentTarget - 1) +') span:nth-child(2)').text().split(' ')[0])
                            
                            $.ajax({
                                url: url,
                                method: 'GET',
                                data:{
                                        id: query,
                                        date: date,
                                        phone: phone,
                                        name: name,
                                        email: email,
                                        children: children,
                                        price:  $('.number-price:eq('+ (currentTarget - 1) +') span:nth-child(2)').text().split(' ')[0]
                                    },
                                dataType: "html"
                            }).done(function(data) {
                                console.log("Приехало");
                                $('.full-content').html(' ').hide().fadeIn(400).append($('<span/>', {
                                    'class': 'full-text',
                                    'text': 'Готово!'
                                }));
                                setTimeout(() => {$('.pop-up').click()}, 3000);                         
                            }).fail(function(jqXHR) {
                                console.log(jqXHR.status);
                                $('.info').append($('<section/>', {
                                    'class': 'ERROR hidden',
                                    text: 'ERROR: ' + jqXHR.status
                                }))
                                $('.ERROR').hide();
                                $('.ERROR').fadeIn(1200);
                            }).always(function() {
                                $('.overlay').hide();
                            });
                    
                        }
                    });
                });
                itter++;
            };
            var bookingResult = [];
            var daysCounter = getDaysCount();
            var booking = getDays();

            function findDates(apiJSON, id){
                for(var x = 1; x < booking.length-1; x++){
                    for(var i = 0; i < apiJSON[id].dates.length; i++){
                        for(var j = 0; j < apiJSON[id].dates[i].date.length; j++){
                            if(apiJSON[id].dates[i].date[j] && (apiJSON[id].dates[i].date[j] == booking[x])){ 
                                bookingResult.push(id);
                                console.log(apiJSON[id].dates[i].date[j] +" = "+ booking[x]);
                            }
                        }
                    }
                }
                bookingResult = bookingResult.filter(function(item, pos) {
                    return bookingResult.indexOf(item) == pos;
                })
            }
            var children = getUrlParameter('children');
           $(document).ready(function() {
                
                if(children == "Да"){
                    children = "с ребёнком";
                }else{
                    children = "без детей";
                };
                var guests = getUrlParameter('guests');
                var apiJSON;
                
                $('.offer-box-span').text('Список доступных номеров на период с '+ booking[0] +' по '+ booking[booking.length-1] +'г. на '+ guests + ' гостя(ей) '+ children +':')
                
                var data = $('.mhmb11pn').text().split(' ');
                $('.area').text($('.mhmb9pnu').text().split('/')[0]);
                $('.day').text($('.day').text() + data[1].split('н')[0] + '°C');
                $('.night').text($('.night').text() + data[2].split('в')[0] + '°C');
                $('.water').text($('.water').text() + data[3] + '°C');


                $('#contacts-nav').click(function(){
                    $('html, body').animate({
                        scrollTop: $('#contacts').offset().top
                    }, {
                        duration: 370,   // по умолчанию «400» 
                        easing: "linear" // по умолчанию «swing» 
                    });
                });

                $.ajax({
                    url: '../api/hotel.json',  
                    method: 'get',             
                    dataType: 'html',          
                    success: function(data){   
                        apiJSON = JSON.parse(data);
                        var result = [1,2,3,4,5,6,7,8,9,10];
                        for(var i = 0; i < apiJSON.length; i++){
                            findDates(apiJSON, i);
                            console.log(bookingResult);
                        }
                        var counter = 0;
                        if(bookingResult.length == 10 || daysCounter < 4){
                            $('.wrapper').append($('<span/>', {
                                'class': 'error-text',
                                'text': 'По данному запросу ничего не найдено :('
                            }));
                        }else{  
                        if(children == "с ребёнком"){
                            for(var i = 0; i < apiJSON.length; i++){
                            if(bookingResult[counter] == i){
                                counter++;
                            }else if(apiJSON[i].children == "yes" && apiJSON[i].humans >= guests){
                                createFullBlock(apiJSON, i);
                            }else continue;
                        }}else{
                            for(var i = 0; i < apiJSON.length; i++){
                                if(bookingResult[counter] == i){
                                    counter++;
                                }else if(apiJSON[i].humans >= guests){
                                    createFullBlock(apiJSON, i);
                                }else continue;
                            }
                        }                      
                    }},
                    error: function(jqXHR) {
                        console.log(jqXHR.status);
                        $('.info').append($('<section/>', {
                            'class': 'ERROR hidden',
                            text: 'ERROR: ' + jqXHR.status
                        }))
                        $('.ERROR').hide();
                        $('.ERROR').fadeIn(1200);
                    }
                });

                
            });
        </script>
        <script type="text/javascript" src="../js/weather.js"></script>
    </body>
    
</html>